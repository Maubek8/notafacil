document.addEventListener("DOMContentLoaded", function() {
    const criarTabelaBtn = document.getElementById("criarTabela");
    criarTabelaBtn.addEventListener("click", criarTabela);
});

function criarTabela() {
    const alunosInput = document.getElementById("alunosRAs");
    const numProvasInput = document.getElementById("numProvas");
    const tabelaVisualizacao = document.getElementById("tabelaVisualizacao");
    const tabelaAlunos = document.getElementById("tabelaAlunos");

    // Limpa a tabela anterior
    tabelaAlunos.innerHTML = '';

    const numProvas = parseInt(numProvasInput.value, 10);
    if (isNaN(numProvas) || numProvas < 1) {
        alert("Insira um número válido de provas.");
        return;
    }

    // Processa os alunos e elimina linhas vazias ou com dados incompletos
    const alunosRAs = alunosInput.value.split("\n").map(linha => linha.trim()).filter(linha => linha.includes(' - '));

    if (alunosRAs.length === 0) {
        alert("Insira ao menos um aluno com RA e Nome no formato correto.");
        return;
    }

    // Cabeçalho da tabela
    let cabecalho = '<tr><th>Nome</th><th>RA</th>';
    for (let i = 0; i < numProvas; i++) {
        cabecalho += `<th>Prova ${i + 1}</th>`;
    }
    cabecalho += '<th>Nota Final</th></tr>';
    tabelaAlunos.innerHTML = cabecalho;

    // Linhas da tabela
    alunosRAs.forEach(linha => {
        const [ra, nome] = linha.split(' - ').map(part => part.trim());

        // Verifica se o RA e o Nome estão preenchidos corretamente
        if (ra && nome) {
            let linhaTabela = `<tr><td>${nome}</td><td>${ra}</td>`;
            for (let i = 0; i < numProvas; i++) {
                linhaTabela += `<td><input type="number" class="nota" min="0" max="10" value="0" oninput="updateTotal(this.parentElement.parentElement)"></td>`;
            }
            linhaTabela += '<td class="total">0</td></tr>';
            tabelaAlunos.innerHTML += linhaTabela;
        }
    });

    tabelaVisualizacao.style.display = 'block';
}

function updateTotal(row) {
    const totalCell = row.querySelector(".total");
    let total = 0;
    row.querySelectorAll(".nota").forEach(nota => {
        total += parseFloat(nota.value) || 0;
    });
    totalCell.textContent = total.toFixed(2);
}
